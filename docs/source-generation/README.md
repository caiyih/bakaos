# Source Generation Framework

本项目随附有一个 Rust Source Generation 框架，旨在为中大型项目提供清晰、高效、可扩展的代码生成支持。它为静态代码生成场景提供统一的抽象与运行时环境，适用于模块化生成任务、符号注册与分析、自动化导出等需求，尤其适合 FFI、DSL 编译器前端、属性宏替代方案等工程场景。

## Menu

- [安装](./installation.md)
- [快速开始](./quickstart.md)
- [架构概览](./core.md)
- [进阶使用](./advance.md)
- [基于语法语义分析的代码生成](./syntax-semantic-analysis.md)
- [注意事项/FAQ](./notice-faq.md)

## 项目简介

### 框架名称与定位

**Source Generation Framework** 是一个灵活、模块化的代码生成框架，主要用于在构建阶段生成 Rust 源码。与 `build.rs`、宏系统等机制互补，该框架更关注「结构化生成」、符号管理以及模块导出等更高阶的任务组织。

框架目标是：

- 将代码生成任务组件化、标准化；
- 通过符号注册机制提供语义层信息流；
- 自动维护输出目录与 mod.rs 文件；

该框架主要为 BakaOS 开发，作为其中一部分随项目开源，也适合被其他项目直接复用或拓展。

### 适用场景

该框架适用于一切需要在构建阶段组织生成 Rust 源码的工程，包括但不限于：

- **FFI 自动绑定**：如根据 C/C++ header 或 metadata 生成 binding。
- **DSL 代码生成**：从 DSL 或配置文件自动生成数据结构与逻辑代码。
- **结构体驱动的注册中心**：统一注册用户定义的结构体并生成调度代码。
- **自动导出 API**：如自动生成 `mod.rs` 或 `pub use` 声明。
- **属性宏/过程宏替代**：在部分无法用宏系统实现的上下文中执行结构化代码生成。

### 快速特性一览

| 特性                | 描述                                                 |
| ------------------- | ---------------------------------------------------- |
| 🧱 任务系统         | 通过实现 `ISourceGenerator` 接口定义独立生成单元     |
| 📂 文件管理         | 支持缓存机制和重复写入检测，防止不必要构建和手动覆盖 |
| 📚 符号注册中心     | 任务间共享结构化符号（如结构体、函数定义）           |
| 🧭 自动 mod.rs 导出 | 支持自动生成模块索引文件，并支持自定义导出风格       |
| 🚦 并行执行支持     | 可并行运行多个生成任务，提高构建效率                 |
| ⚙️ 灵活集成         | 可作为独立 crate 引入，也可作为构建脚本的子模块      |

### 工作原理

框架基于「任务（Task）」模型运行，每一个实现了 `ISourceGenerator` 的任务负责生成一个或多个源文件。所有任务运行于统一的 **SourceGenerationDriver** 上，并共享一个 **SourceGenerationContext**：

1. 所有任务在同一生成上下文中注册；
2. 执行任务时上下文会记录生成的文件、符号与模块信息；
3. 在最终阶段，由内置工具自动生成 `mod.rs`，并写入目标目录；
4. 框架内置文件缓存检测，避免不必要的 I/O 操作；

这个流程使得代码生成在语义组织、模块结构维护与并发效率上具备良好的一致性和可维护性。
